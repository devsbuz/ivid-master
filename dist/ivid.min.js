/**
 * @ividjs/ivid - v1.0.7
 * Copyright 2019 Alex Perez (alxpez)
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var o=function(e){var t="",n=Math.floor(e),o=Math.floor(e/3600);o>0&&(n-=3600*o,t+="".concat(o,":"));var r,u=Math.floor(e/60);return u>0&&(n-=60*u),t+="".concat(u,":").concat((r=n)>9?"".concat(r):"0".concat(r))},r=function(){return!!(document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)},u=function(){r()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)};function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e){var t="function"==typeof Map?new Map:void 0;return(s=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,o)}function o(){return d(e,arguments,p(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),m(o,e)})(e)}function d(e,t,n){return(d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var o=[null];o.push.apply(o,t);var r=new(Function.bind.apply(e,o));return n&&m(r,n.prototype),r}).apply(null,arguments)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(e){function t(){var e,n,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,r=p(t).call(this),e=!r||"object"!==a(r)&&"function"!=typeof r?c(n):r,Object.defineProperties(c(c(e)),{state:{value:e.setup(),writable:!0},setState:{value:function(t){for(var n in t)t.hasOwnProperty(n)&&(e.state[n]=t[n]);e.render()}},onProgressClick:{value:function(t){var n=e.state.videoTemplate,o=e.state.controls.progress.progressWrapper,r=(t.pageX-(o.offsetLeft+o.offsetParent.offsetLeft))/o.offsetWidth;n.currentTime=r*n.duration}},onPlayClick:{value:function(t){t.preventDefault(),e.togglePlay()}},onVolumeClick:{value:function(t){t.preventDefault(),e.toggleMute()}},onVolumeHover:{value:function(){e.state.controls.volume.volumeSlider.setAttribute("data-state","open")}},onVolumeLeave:{value:function(){e.state.controls.volume.volumeSlider.setAttribute("data-state","close")}},onVolumeChange:{value:function(t){e.changeVolume(t.target.value)}},onFullscreenClick:{value:function(){u(),e.changeButtonState("fullscreen")}},onVideoClick:{value:function(t){t.preventDefault(),e.togglePlay(),e.onShowControls()}},onLoadedMetadata:{value:function(){var t=e.state.controls,n=e.state.videoTemplate;t.volume.volumeSlider.setAttribute("value",100*n.volume),e.changeButtonState("mute"),e.changeButtonState("pause")}},onTimeUpdate:{value:function(){var t=e.state,n=t.model[t.current],r=t.videoTemplate,u=e.state.controls;if(u.time.innerHTML="".concat(o(r.currentTime||0),"  /  ").concat(o(r.duration||0)),u.progress.progressValue.style.width=Math.floor(r.currentTime/r.duration*100)+"%",t.choicesTemplate.hasAttribute("data-state")&&n.options&&n.options.choices){var a=n.options.timeout,i=a||10;r.duration-r.currentTime<=i&&(t.videoAttrs.controls&&t.controls.controlsTemplate.setAttribute("data-state","hidden"),t.choicesTemplate.removeAttribute("data-state"))}if(r.duration-r.currentTime<=1){var l=null;t.next?l=t.next:n.options&&(l=n.options.fallback||Object.keys(n.options.choices)[0]),e.onChoiceSelected(l)}}},onVideoEnded:{value:function(){var t=e.state;t.choicesTemplate.setAttribute("data-state","hidden"),t.next&&(e.setAttribute("current",t.next),t.videoAttrs.controls&&t.controls.controlsTemplate.removeAttribute("data-state"))}},onChoiceSelected:{value:function(t,n){n&&n.preventDefault();var o=e.state.choicesTemplate;e.setAttribute("next",t),e.state.next=t;for(var r=0;r<o.children.length;r++){var u=o.children[r];u.id.toString()===t.toString()?u.setAttribute("data-state","selected"):u.removeAttribute("data-state")}}},onShowControls:{value:function(){var t=e.state.choicesTemplate,n=e.state.controls.controlsTemplate;clearTimeout(e.state.timer),e.state.timer=setTimeout(function(){n.setAttribute("data-state","hidden")},2300),t.getAttribute("data-state")&&n.removeAttribute("data-state")}},onKeydown:{value:function(t){e.onShowControls();var n=e.state.videoTemplate;switch(t.keyCode){case 70:u();break;case 77:e.toggleMute();break;case 39:e.forwardVideo();break;case 37:e.backwardVideo();break;case 38:e.changeVolume(100*n.volume+10);break;case 40:e.changeVolume(100*n.volume-10);break;case 32:e.togglePlay()}}}}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,s(HTMLElement)),l(t,null,[{key:"observedAttributes",get:function(){return["model","current"]}}]),l(t,[{key:"connectedCallback",value:function(){this.render()}},{key:"attributeChangedCallback",value:function(e,t,n){var o,r,u;null!==t&&this.setState((o={},r=e,u="model"===e?JSON.parse(n):n,r in o?Object.defineProperty(o,r,{value:u,enumerable:!0,configurable:!0,writable:!0}):o[r]=u,o))}},{key:"setup",value:function(){var e=this,t={autoplay:this.hasAttribute("autoplay")||null,controls:this.hasAttribute("controls")||null,muted:this.hasAttribute("muted")||null,playsinline:this.hasAttribute("playsinline")||null,poster:this.getAttribute("poster"),preload:this.getAttribute("preload")},n=JSON.parse(this.getAttribute("model")),o=this.getAttribute("next")||"",r=this.getAttribute("current");r||(r=Object.keys(n)[0],this.setAttribute("current",r));var u,a,i,l=((u=document.createElement("div")).setAttribute("class","ivid"),u),c=((a=this.firstElementChild)||(a=document.createElement("video")),a.classList.add("ivid__video"),a),s=((i=document.createElement("div")).setAttribute("class","ivid__choices"),i.setAttribute("data-state","hidden"),i),d=function(){var e=document.createElement("div");e.setAttribute("class","ivid__ctrls");var t=document.createElement("div");t.setAttribute("class","ivid__ctrls-wrapper");var n=document.createElement("div");n.setAttribute("class","ivid__ctrls-progress");var o=document.createElement("div");o.setAttribute("class","ivid__ctrls-progress-bg");var r=document.createElement("span");r.setAttribute("class","ivid__ctrls-progress-value");var u=document.createElement("div");u.setAttribute("class","ivid__ctrls-progress-trackball");var a={progressWrapper:n,progressValue:r,progressTrackball:u},i=document.createElement("div");i.setAttribute("class","ivid__ctrls-buttons-wrapper");var l=document.createElement("button");l.setAttribute("data-state","pause"),l.setAttribute("class","ivid__ctrls-button material-icons");var c=document.createElement("div");c.setAttribute("class","ivid__ctrls-volume-wrapper");var s=document.createElement("button");s.setAttribute("data-state","volume_up"),s.setAttribute("class","ivid__ctrls-button material-icons");var d=document.createElement("input");d.setAttribute("data-state","close"),d.setAttribute("class","ivid__ctrls-volume"),d.type="range",d.min=0,d.max=100,d.step=1;var m={volumeWrapper:c,volumeButton:s,volumeSlider:d},p=document.createElement("span");p.setAttribute("class","ivid_ctrls-time"),p.innerHTML="0:00  /  0:00";var v=document.createElement("div");v.setAttribute("class","ivid__ctrls-spacer");var f=document.createElement("button");return f.setAttribute("data-state","fullscreen"),f.setAttribute("class","ivid__ctrls-button material-icons"),o.appendChild(r),o.appendChild(u),n.appendChild(o),c.appendChild(s),c.appendChild(d),i.appendChild(l),i.appendChild(c),i.appendChild(p),i.appendChild(v),i.appendChild(f),t.appendChild(n),t.appendChild(i),e.appendChild(t),{controlsTemplate:e,progress:a,playButton:l,volume:m,time:p,fullscreenButton:f}}();this.innerHTML="",l.appendChild(c),l.appendChild(s),l.appendChild(d.controlsTemplate),this.appendChild(l),document.onkeydown=function(t){return e.onKeydown(t)},l.onmousemove=function(){return e.onShowControls()},l.onmouseleave=function(e){d.controlsTemplate.setAttribute("data-state","hidden")};var m=setTimeout(null,300);return{videoAttrs:t,model:n,next:o,current:r,baseTemplate:l,videoTemplate:c,choicesTemplate:s,controls:d,timer:m}}},{key:"render",value:function(){var e,t,n,o,r,u,a,i,l,c,s,d,m=this.state,p=m.model[m.current];this.onChoiceSelected(""),p.options&&p.options.choices?(e=m.choicesTemplate,t=p,n=this.onChoiceSelected,o=t.options.choices,e.innerHTML="",e.setAttribute("data-state","hidden"),Object.keys(o).map(function(t){var r=document.createElement("button");r.setAttribute("class","ivid__choice-button"),r.id=t,r.innerHTML=o[t],r.ontouchstart=function(e){return n(t,e)},r.onclick=function(e){return n(t,e)},e.appendChild(r)})):function(e){e.innerHTML="",e.setAttribute("data-state","hidden")}(m.choicesTemplate),function(e,t,n,o,r,u,a){e.id=n.uid,e.src=n.src,t.autoplay&&(e.autoplay=!0),t.muted&&(e.muted=!0),t.playsinline&&(e.playsinline=!0),t.poster&&(e.poster=t.poster),t.preload&&(e.preload=t.preload),e.ontouchstart=function(e){return o(e)},e.onclick=function(e){return o(e)},e.onloadedmetadata=function(){return r()},a&&(e.ontimeupdate=function(){return a()}),u&&(e.onended=function(){return u()})}(m.videoTemplate,m.videoAttrs,p,this.onVideoClick,this.onLoadedMetadata,p.options?this.onVideoEnded:null,p.options?this.onTimeUpdate:null),r=m.controls,u=this.onProgressClick,a=this.onPlayClick,i=this.onVolumeClick,l=this.onVolumeHover,c=this.onVolumeLeave,s=this.onVolumeChange,d=this.onFullscreenClick,r.progress.progressWrapper.ontouchstart=function(e){return u(e)},r.progress.progressWrapper.onclick=function(e){return u(e)},r.playButton.ontouchstart=function(e){return a(e)},r.playButton.onclick=function(e){return a(e)},r.volume.volumeWrapper.onmouseover=function(){return l()},r.volume.volumeWrapper.onmouseleave=function(){return c()},r.volume.volumeButton.ontouchstart=function(e){return i(e)},r.volume.volumeButton.onclick=function(e){return i(e)},r.volume.volumeSlider.oninput=function(e){return s(e)},r.volume.volumeSlider.onchange=function(e){return s(e)},r.fullscreenButton.ontouchstart=function(){return d()},r.fullscreenButton.onclick=function(){return d()}}},{key:"forwardVideo",value:function(){var e=this.state.videoTemplate;e.currentTime++>e.duration?e.currentTime=e.duration:e.currentTime++}},{key:"backwardVideo",value:function(){var e=this.state.videoTemplate;e.currentTime--<0?e.currentTime=0:e.currentTime--}},{key:"togglePlay",value:function(){var e=this.state.videoTemplate;e.paused?e.play():e.pause(),this.changeButtonState("play")}},{key:"toggleMute",value:function(){var e=this.state.videoTemplate;e.muted=!e.muted,this.changeButtonState("mute")}},{key:"changeVolume",value:function(e){var t=this.state.videoTemplate;t.volume=e>100?1:e<0?0:e/100,t.muted=e<=0,this.changeButtonState("mute")}},{key:"changeButtonState",value:function(e){var t=this.state.baseTemplate,n=this.state.videoTemplate,o=this.state.controls;switch(e){case"play":o.playButton.setAttribute("data-state",n.paused||n.ended?"play_arrow":"pause");break;case"mute":o.volume.volumeSlider.setAttribute("value",100*n.volume),o.volume.volumeButton.setAttribute("data-state",n.muted?"volume_off":n.volume>=.5?"volume_up":"volume_down");break;case"fullscreen":t.setAttribute("data-state",r()?"fullscreen":""),o.fullscreenButton.setAttribute("data-state",r()?"fullscreen":"fullscreen_exit")}}}]),t}();customElements.define("i-video",v)}]);